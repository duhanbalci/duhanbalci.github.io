<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="yanm1ng&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      Nginx Çoklu Domain, Server Block Ayarları | Duhan BALCI
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png">
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Duhan BALCI</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Anasayfa</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Anasayfa</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>Nginx Çoklu Domain, Server Block Ayarları</h2>
  <p class="post-date">2019-02-16</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p>Öncelikle Nginx kurulumu ve basit konfigürasyonunu anlattığım bir önceki yazıma <a href="https://duhanbalci.com/Ubuntu-16-04-Nginx-PHP7.2-MariaDB-Kurulumu-Ve-Konfigurasyonu/">şuradan</a> ulaşabilirsiniz.</p>
<p>Nginx’in ana konfigürasyon dosyası <strong>/etc/nginx/nginx.conf</strong> dosyasıdır.Ubuntu kurulumunda dosyanın içinde alttaki 2 satır’da vardır.</p>
<pre><code>include /etc/nginx/conf.d/*.conf;
include /etc/nginx/sites-enabled/*;
</code></pre><p>Gördüğünüz gibi <strong>conf.d/</strong> ve <strong>sites-enabled/</strong> dizinindeki tüm dosyaları include ediyor.Yani bizim bu klasörlere eklediğimiz her dosya nginx tarafından okunuyor.Eğer <strong>/etc/nginx/nginx.conf</strong> içerisinde bu satırlar yoksa <strong>http</strong> block’unun içine ekleyebilirsiniz.  </p>
<p>Şimdi istediğimiz şey birden fazla domain’i bir sunucu üzerinde kullanmak.Bunun için öncelikle <strong>domain panelinizden dns ayarlarınıza girip, sunucu ip adresiniz için A kaydı eklemeniz</strong> gereklidir.Bu işlem genelde bir kaç saatte gerçekleşir ama bazen daha da uzun sürebilir.<br>Bu işlem domain’ninizi sunucunuza yönlendirmek için yeterlidir.Sırada Nginx ile bunu kontrol etmek var.  </p>
<p>Nginx ile bu domain’leri kontrol etmek için konfigürasyon dosyasına <strong>server block</strong>‘lar eklememiz gerekiyor.Bunu ister <strong>conf.d/</strong> dizini altına açacağınız tek bir dosyaya, isterseniz benim de tercih ettiğim gibi <strong>sites-enabled/</strong> dizini altına her domain için ayrı ayrı block dosyaları oluşturarak yapabilirsiniz.</p>
<p>Örnekte biz 2 adet domain ve bu domain’lerden birisine ait subdomain için server block dosyaları oluşturacağız.Örnek domainlerimiz:</p>
<blockquote>
<ul>
<li><a href="http://duhanbalci.com/">duhanbalci.com</a></li>
<li><a href="http://balciduhan.com/" target="_blank" rel="noopener">balciduhan.com</a></li>
<li><a href="http://sub.duhanbalci.com/" target="_blank" rel="noopener">sub.duhanbalci.com</a></li>
</ul>
</blockquote>
<p>Domain kontrol panelinizden subdomain için de A kaydı eklemeyi unutmayın.Eğer her subdomain için ayrı ayrı kayıt eklemek istemiyorsanız subdomain yerine “ <strong>*</strong> “ koyarak A kaydınızı ekleyebilirsiniz.Böylece tüm subdomainler sizin sunucunuza yönlenecektir.Domain firmanız bunu desteklemiyorsa nameserver’larınızı <a href="https://cloudflare.com/" target="_blank" rel="noopener">cloudflare</a>‘ye yönlendirerek cloudflare’nin dns servisini kullanabilirsiniz.  </p>
<p>Öncelikle varolan server block doolmasısyalarını silmek için alttaki komutu kullanıyoruz.Öncelikle varolan server block dosyalarını silmek için alttaki komutu kullanıyoruz.</p>
<pre><code>rm /etc/nginx/conf.d/*
rm /etc/nginx/sites-enabled/*
</code></pre><p>Server block dosyalarımızı <strong>sites-enabled/</strong> dizini altında oluşturacağız.Her domain’in root klasörü ise /var/www/<strong>domain</strong> formatında olacak.Alttaki komutlarla root klasörlerimizi oluşturuyoruz.</p>
<pre><code>mkdir /var/www/duhanbalci.com
mkdir /var/www/balciduhan.com
mkdir /var/www/sub.duhanbalci.com
</code></pre><p>Server block dosyalarımızın yapısı aynı olacağı için her birini teker teker yazmayacağım.Alttaki <strong><a href="http://duhanbalci.com/">duhanbalci.com</a></strong> için oluşturacağımız server block dosyasının içeriği olacak.Diğerleri için <strong>server_name</strong> ve <strong>root</strong> parametrelerini değiştirmeniz yeterlidir.Alttaki konfigürasyon PHP7.2 içindir.Eğer sizinki farklıysa <strong>location ~ .php$ {</strong> ile başlayan blok değiştirilmelidir.</p>
<pre><code>server {
  listen 80;
  listen [::]:80;
  server_name duhanbalci.com www.duhanbalci.com;
  root /var/www/duhanbalci.com;
  index index.php index.html index.htm ;

  location / {
    try_files $uri $uri/ =404;
  }

  error_page 404 /404.html;
  error_page 500 502 503 504 /50x.html;

  location = /50x.html {
    root /usr/share/nginx/html;
  }

  location ~ \.php$ {
    fastcgi_pass unix:/run/php/php7.2-fpm.sock;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;
    include snippets/fastcgi-php.conf;
  }
  location ~ /\.ht {
    deny all;
  }
}
</code></pre><p>Şimdi server block dosyamızı oluşturup üsttekileri içine yapıştıralım.</p>
<pre><code>nano /etc/nginx/sites-enabled/duhanbalci.com
</code></pre><p>Kaydedip çıktıktan sonra bu domain için işimiz bitmiş demektir.Diğer domainler için de aynı şekilde dosya oluşturup, içine üsttekileri yapıştırdıktan sonra değiştirilmesi gereken yerleri değiştirerek kaydedip çıktıktan sonra, alttaki komutla nginx’i yeniden başlatıyoruz.Ya da <strong>restart</strong> yerine <strong>reload</strong>yazarak da oluşturduğumuz dosyaların geçerli kılınmasını sağlayabilirsiniz.</p>
<pre><code>sudo systemctl restart nginx
</code></pre><p>Herşeyi doğru yaptıysanız domain’leriniz sunucunuza başarıyla yönlenmiş demektir.</p>
</section>
    <!-- Tags START -->
    
    <!-- Tags END -->
    <!-- NAV START -->
    
    <!-- NAV END -->
    
      <!-- No Comment -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="nav">none</ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://duhanbalci.com/Node-js-Nedir-Nasil-Kurulur-Windows-Linux-MacOS/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>
    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2019 Duhan BALCI
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<script src="/js/script.js"></script>
  </body>
</html>